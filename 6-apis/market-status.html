<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Market Status (JSON)</title>
</head>
<body>

    <h1>Market Status (JSON)</h1>
    <a href="../index.html">Home</a>

    <h2>Dataset Information</h2>
    <p>For this exercise, we will use data from the AlphaVantage API.
        Specifically we will use the <a href="https://www.alphavantage.co/documentation/#market-status">"Market Status" endpoint</a>
        to fetch information about the current status of major trading venues around the world.
        Consult the API documentation to learn more.
    </p>

    <h2>Setup</h2>
    <p>First obtain an AlphaVantage API Key, and supply it when prompted.</p>

    <h2>Part 1</h2>
    <p>
        Write JavaScript code to answer the questions below.
        Log each of the answers to the console.

        <ol type="A">
            <li>Fetch market status data from the API.</li>
            <li>Display the number of markets.</li>
            <li>Filter the markets to identify only those that have a market type of "Equity", and store them in a variable called <code>equityMarkets</code>.</li>
            <li>Display the number of equity markets.</li>
            <li>Loop through the equity markets and display the market type and region of each.</li>
            <li>Use a find operation to identify the equity market that has a region of "United States", and store it in a variable called <code>market</code>.</li>
            <li>Display information about the US market, including: the market type, the primary exchanges, the local open and close time, and the current market status. Format the market status using all capital letters.</li>
        </ol>
    </p>


    <h2>Part 2</h2>
    <p>
        Write JavaScript code to answer the questions below.
        Display the answers on the page in the designated areas.
    </p>

    <ol type="A">
        <li>Using the designated <code>span</code> elements below,
            display information about the US market, including it's region, market type,
            primary exchanges, local open and close times, and current status.
        </li>
    </ol>

    <hr>
    <h2>Display</h2>

    <!--select name="region" id="select-region">
        <option value="N/A">Select an Equity Market Region</option>
    </select-->

    <div id="display-market-info">
        <p>Region: <span id="display-region">TODO</span></p>
        <p>Market Type: <span id="display-type">TODO</span></p>
        <p>Primary Exchanges: <span id="display-exchanges">TODO</span></p>
        <p>Local Open: <span id="display-open">TODO</span></p>
        <p>Local Close: <span id="display-close">TODO</span></p>
        <p>Current Status: <span id="display-status">TODO</span></p>
    </div>




    <script>
        document.addEventListener("DOMContentLoaded", function () {
          const apiKey = "OPEKNZB4Q8AUFTDY";
          const url = `https://www.alphavantage.co/query?function=MARKET_STATUS&apikey=${apiKey}`;
        
          fetch(url)
            .then(response => response.json())
            .then(data => {
              if (!data.markets) {
                console.error("No 'markets' data returned from API:", data);
                alert("Could not load market status. Check your API key or limit.");
                return;
              }
        
              // Part 1
              const markets = data.markets;
              console.log("Total Markets:", markets.length);
        
              const equityMarkets = markets.filter(m => m.market_type === "Equity");
              console.log("Equity Markets:", equityMarkets.length);
        
              equityMarkets.forEach(m => {
                console.log(`Market Type: ${m.market_type}, Region: ${m.region}`);
              });
        
              const usMarket = equityMarkets.find(m => m.region === "United States");
        
              if (usMarket) {
                console.log("U.S. Market Info:");
                console.log("Market Type:", usMarket.market_type);
                console.log("Primary Exchanges:", usMarket.primary_exchanges.join(", "));
                console.log("Open:", usMarket.local_open);
                console.log("Close:", usMarket.local_close);
                console.log("Status:", usMarket.current_status.toUpperCase());
        
                // Part 2 â€“ Update DOM
                document.getElementById("display-region").textContent = usMarket.region;
                document.getElementById("display-type").textContent = usMarket.market_type;
                document.getElementById("display-exchanges").textContent = usMarket.primary_exchanges.join(", ");
                document.getElementById("display-open").textContent = usMarket.local_open;
                document.getElementById("display-close").textContent = usMarket.local_close;
                document.getElementById("display-status").textContent = usMarket.current_status.toUpperCase();
              } else {
                console.warn("U.S. market not found in the data.");
              }
            })
            .catch(error => {
              console.error("Fetch Error:", error);
              alert("An error occurred while fetching market data.");
            });
        });
        </script>
        
</body>
</html>
